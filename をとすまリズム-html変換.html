<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>をとすまリズム（音付き＆キーボード対応）</title>
<style>
  body { font-family: sans-serif; text-align: center; margin-top: 50px; }
  .button-container { display: flex; justify-content: center; gap: 20px; margin-top: 30px; }
  .btn {
    width: 80px; height: 80px; font-size: 24px;
    border-radius: 10px; border: 2px solid #333;
    cursor: pointer; background-color: #eee;
    transition: background-color 0.2s;
  }
  .active { background-color: #ffcc00; }
  #score { font-size: 24px; margin-top: 20px; }
</style>
</head>
<body>

<h1>をとすまリズム（音付き＆キーボード対応）</h1>
<p>光る順番を覚えてボタンをクリック／キーボードで押そう！</p>

<div class="button-container">
  <button class="btn" data-char="を">を</button>
  <button class="btn" data-char="と">と</button>
  <button class="btn" data-char="す">す</button>
  <button class="btn" data-char="ま">ま</button>
</div>

<div id="score">スコア: 0</div>
<div id="message"></div>

<script>
// ゲーム設定
const chars = ["を","と","す","ま"];
const keyMap = { "w":"を", "t":"と", "s":"す", "m":"ま" };
const sounds = {
  "を": new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"),
  "と": new Audio("https://actions.google.com/sounds/v1/cartoon/slide_whistle_to_drum_hit.ogg"),
  "す": new Audio("https://actions.google.com/sounds/v1/cartoon/metal_twang.ogg"),
  "ま": new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg")
};

let sequence = [];
let playerIndex = 0;
let score = 0;

// 光らせて音を鳴らす
function highlightButton(char) {
  const btn = document.querySelector(`.btn[data-char="${char}"]`);
  btn.classList.add("active");
  if(sounds[char]) sounds[char].play();
  setTimeout(() => btn.classList.remove("active"), 500);
}

// ランダムに1文字追加
function addToSequence() {
  const randChar = chars[Math.floor(Math.random() * chars.length)];
  sequence.push(randChar);
}

// シーケンス再生
function playSequence() {
  let delay = 0;
  sequence.forEach(char => {
    setTimeout(() => highlightButton(char), delay);
    delay += 700;
  });
}

// 次のラウンド
function nextRound() {
  addToSequence();
  playerIndex = 0;
  setTimeout(playSequence, 500);
}

// 判定処理
function handleInput(char) {
  if(char === sequence[playerIndex]) {
    playerIndex++;
    if(playerIndex === sequence.length) {
      score++;
      document.getElementById("score").textContent = "スコア: " + score;
      nextRound();
    }
  } else {
    document.getElementById("message").textContent = "ゲームオーバー！ 最終スコア: " + score;
    sequence = [];
    playerIndex = 0;
    score = 0;
    document.getElementById("score").textContent = "スコア: 0";
    setTimeout(() => { document.getElementById("message").textContent = ""; nextRound(); }, 1000);
  }
}

// ボタンクリック対応
document.querySelectorAll(".btn").forEach(btn => {
  btn.addEventListener("click", () => {
    const char = btn.dataset.char;
    highlightButton(char);
    handleInput(char);
  });
});

// キーボード対応
document.addEventListener("keydown", e => {
  const char = keyMap[e.key.toLowerCase()];
  if(char) {
    highlightButton(char);
    handleInput(char);
  }
});

// 最初のラウンド開始
nextRound();
</script>

</body>
</html>